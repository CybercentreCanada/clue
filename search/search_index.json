{"config":{"lang":["en","fr"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Home","text":""},{"location":"developer/CONTRIBUTING/","title":"CONTRIBUTING","text":""},{"location":"developer/CONTRIBUTING/#contributing","title":"Contributing","text":""},{"location":"developer/CONTRIBUTING/#branch-strategy","title":"Branch Strategy","text":"<p>The Clue project follows a Git flow branching model to ensure stable releases and organized development:</p>"},{"location":"developer/CONTRIBUTING/#main-branches","title":"Main Branches","text":"<ul> <li><code>main</code>: Contains production-ready code. All releases are tagged from this branch. Direct commits to <code>main</code> are restricted.</li> <li><code>develop</code>: The integration branch for new features and the primary development branch. All feature branches are created from and merged back into <code>develop</code>.</li> </ul>"},{"location":"developer/CONTRIBUTING/#supporting-branches","title":"Supporting Branches","text":"<ul> <li>Feature branches: Created from <code>develop</code> for new features or enhancements. Use descriptive names like <code>feature/add-oauth-provider</code> or <code>feature/improve-caching</code>.</li> <li>Release branches: Created from <code>develop</code> when preparing for a new release (e.g., <code>release/v2.1.0</code>). Used for final testing and minor bug fixes.</li> <li>Hotfix branches: Created from <code>main</code> for critical bug fixes that need immediate deployment (e.g., <code>hotfix/security-patch</code>).</li> </ul>"},{"location":"developer/CONTRIBUTING/#development-workflow","title":"Development Workflow","text":"<ol> <li>Feature Development: Create a feature branch from <code>develop</code></li> <li>Integration: Merge completed features into <code>develop</code> via pull request</li> <li>Release Preparation: Create a release branch from <code>develop</code> when ready for release</li> <li>Production Release: Merge release branch into both <code>main</code> and <code>develop</code>, then tag the release</li> <li>Hotfixes: If critical issues are found in production, create hotfix branches from <code>main</code></li> </ol>"},{"location":"developer/CONTRIBUTING/#pull-request-process","title":"Pull Request Process","text":"<p>All code changes must go through the pull request process to ensure code quality and maintain project standards:</p>"},{"location":"developer/CONTRIBUTING/#for-contributors-with-write-access","title":"For Contributors with Write Access","text":"<ol> <li>Create Feature Branch: Create a new branch from <code>develop</code> with a descriptive name</li> </ol> <pre><code>git checkout develop\ngit pull origin develop\ngit checkout -b feature/your-feature-name\n</code></pre> <ol> <li> <p>Implement Changes: Make your changes, following the project's coding standards and including appropriate tests</p> </li> <li> <p>Open Pull Request: Create a PR targeting the <code>develop</code> branch with:</p> </li> <li>Clear, descriptive title</li> <li>Detailed description of changes</li> <li>Reference to any related issues</li> <li>Screenshots or examples if applicable</li> </ol>"},{"location":"developer/CONTRIBUTING/#for-external-contributors","title":"For External Contributors","text":"<ol> <li> <p>Fork Repository: Fork the Clue repository to your GitHub account</p> </li> <li> <p>Clone and Setup: Clone your fork and set up the development environment as described in this guide</p> </li> <li> <p>Create Feature Branch: Create a branch from <code>develop</code> in your fork</p> </li> <li> <p>Implement and Test: Make your changes and ensure all checks pass</p> </li> <li> <p>Submit Pull Request: Open a PR from your fork's feature branch to the main repository's <code>develop</code> branch</p> </li> </ol>"},{"location":"developer/CONTRIBUTING/#review-process","title":"Review Process","text":"<ul> <li>Required Approvals: All pull requests require at least two approvals from project maintainers</li> <li> <p>Automated Checks: PRs must pass all automated checks including:</p> </li> <li> <p>Unit tests and integration tests</p> </li> <li>Code formatting and linting</li> <li>Type checking</li> <li> <p>Security scans</p> </li> <li> <p>Code Review: Reviewers will examine:</p> </li> <li>Code quality and adherence to project standards</li> <li>Test coverage and quality</li> <li>Documentation updates if needed</li> <li>Security implications</li> <li>Performance considerations</li> </ul>"},{"location":"developer/CONTRIBUTING/#merge-and-release","title":"Merge and Release","text":"<ul> <li>Merge to Develop: Once approved and all checks pass, the PR is merged into <code>develop</code></li> <li>Release Cycle: Features merged into <code>develop</code> will be included in the next release when <code>develop</code> is merged into <code>main</code></li> <li>Release Timeline: Release schedules are determined by the project maintainers based on feature readiness and testing completion. There's no guaranteed duration from merge to release.</li> </ul>"},{"location":"developer/CONTRIBUTING/#best-practices","title":"Best Practices","text":"<p>In order to maintain high code quality in clue:</p> <ul> <li>Keep PRs focused and reasonably sized</li> <li>Include comprehensive test coverage for new features</li> <li>Update documentation for user-facing changes</li> <li>Rebase your branch if requested to maintain a clean history</li> <li>All PRs will be squash merged into the trunk.</li> </ul>"},{"location":"developer/CONTRIBUTING/#getting-help","title":"Getting Help","text":"<p>You can reach the Clue developemnt team on the CCCS aurora discord: https://discord.gg/GUAy9wErNu</p>"},{"location":"developer/backend/","title":"Clue API Development Guide","text":""},{"location":"developer/backend/#clue-api-development-guide","title":"Clue API Development Guide","text":"<p>This guide outlines how to set up a development environment for the Clue API.</p>"},{"location":"developer/backend/#prerequisites","title":"Prerequisites","text":"<p>Before you begin, ensure you have the following installed on your system:</p> <ul> <li>Python 3.10, 3.11, or 3.12 (3.12 recommended)</li> <li>Poetry for dependency management</li> <li>Docker and Docker Compose for test dependencies</li> <li>Git</li> </ul>"},{"location":"developer/backend/#development-environment-setup","title":"Development Environment Setup","text":""},{"location":"developer/backend/#1-clone-the-repository","title":"1. Clone the Repository","text":"<pre><code>git clone https://github.com/CybercentreCanada/clue.git\ncd clue/api\n</code></pre>"},{"location":"developer/backend/#2-install-poetry","title":"2. Install Poetry","text":"<p>If you don't have Poetry installed, follow the official installation guide.</p> <p>Verify Poetry installation:</p> <pre><code>poetry --version\n</code></pre>"},{"location":"developer/backend/#3-set-up-python-environment","title":"3. Set Up Python Environment","text":"<p>Configure Poetry to use Python 3.12 (or your preferred version):</p> <pre><code>poetry env use 3.12\n</code></pre> <p>Verify the environment:</p> <pre><code>poetry env info\n</code></pre>"},{"location":"developer/backend/#4-install-dependencies","title":"4. Install Dependencies","text":"<p>Install all dependencies including development and test dependencies:</p> <pre><code>poetry install --all-extras --with test,dev,types\n</code></pre> <p>This will install:</p> <ul> <li>Core dependencies</li> <li>Server extras (Werkzeug, bcrypt, PyYAML, etc.)</li> <li>Test dependencies (pytest, mypy, coverage, etc.)</li> <li>Development dependencies (pre-commit, ruff, etc.)</li> <li>Type checking dependencies</li> </ul>"},{"location":"developer/backend/#5-create-required-directories-and-configuration","title":"5. Create Required Directories and Configuration","text":"<p>Create the necessary directories for Clue configuration and logs:</p> <pre><code>sudo mkdir -p /etc/clue/conf/\nsudo mkdir -p /etc/clue/lookups/\nsudo mkdir -p /var/log/clue\nsudo chmod a+rw /etc/clue/conf/\nsudo chmod a+rw /etc/clue/lookups/\nsudo chmod a+rw /var/log/clue\n</code></pre> <p>Copy configuration files:</p> <pre><code>cp build_scripts/classification.yml /etc/clue/conf/classification.yml\ncp test/unit/config.yml /etc/clue/conf/config.yml\n</code></pre>"},{"location":"developer/backend/#6-start-test-dependencies","title":"6. Start Test Dependencies","text":"<p>Start the required services (Redis and Keycloak) using Docker Compose:</p> <pre><code>cd dev\ndocker-compose up --build -d\ncd ..\n</code></pre> <p>Wait for services to be healthy:</p> <pre><code>poetry run python build_scripts/keycloak_health.py\n</code></pre>"},{"location":"developer/backend/#development-workflow","title":"Development Workflow","text":""},{"location":"developer/backend/#code-quality-and-formatting","title":"Code Quality and Formatting","text":"<p>The project uses several tools to maintain code quality:</p> <pre><code># Check formatting\npoetry run ruff format clue --diff\n\n# Apply formatting\npoetry run ruff format clue\n\n# Run linter checks\npoetry run ruff check clue\n\n# Fix auto-fixable issues\npoetry run ruff check clue --fix\n\n# Run type checking\npoetry run type_check\n\n# Run all tests\npoetry run test\n</code></pre>"},{"location":"developer/backend/#test-specific-files-or-functions","title":"Test Specific Files or Functions","text":"<pre><code># Run specific test files\npoetry run pytest test/unit/test_specific_module.py\n\n# Run specific test functions\npoetry run pytest test/unit/test_specific_module.py::test_function_name\n</code></pre>"},{"location":"developer/backend/#starting-the-development-server","title":"Starting the Development Server","text":"<p>Start the Clue API server:</p> <pre><code>poetry run server\n</code></pre> <p>The server will start and be available at the configured port, usually 5000 (check your config.yml anmd environment variables for details).</p>"},{"location":"developer/backend/#testing-enrichment-services","title":"Testing Enrichment Services","text":"<p>For testing connections to plugins from the central API, you may need to start additional test servers:</p> <pre><code># Terminal 1\npoetry run flask --app test.utils.test_server run --no-reload --port 5008\n\n# Terminal 2\npoetry run flask --app test.utils.bad_server run --no-reload --port 5009\n\n# Terminal 3\npoetry run flask --app test.utils.slow_server run --no-reload --port 5010\n\n# Terminal 4\npoetry run flask --app test.utils.telemetry_server run --no-reload --port 5011\n</code></pre>"},{"location":"developer/backend/#project-structure","title":"Project Structure","text":"<pre><code>api/\n\u251c\u2500\u2500 clue/              # Main application code\n\u2502   \u251c\u2500\u2500 api/           # API endpoints\n\u2502   \u251c\u2500\u2500 cache/         # Caching utilities\n\u2502   \u251c\u2500\u2500 common/        # Common utilities and helpers\n\u2502   \u251c\u2500\u2500 constants/     # Application constants\n\u2502   \u251c\u2500\u2500 cronjobs/      # Scheduled tasks\n\u2502   \u251c\u2500\u2500 extensions/    # Flask extensions\n\u2502   \u251c\u2500\u2500 helper/        # Helper modules\n\u2502   \u251c\u2500\u2500 models/        # Data models\n\u2502   \u251c\u2500\u2500 plugin/        # Plugin system\n\u2502   \u251c\u2500\u2500 remote/        # Remote service integrations\n\u2502   \u251c\u2500\u2500 security/      # Security modules\n\u2502   \u2514\u2500\u2500 services/      # Business logic services\n\u251c\u2500\u2500 build_scripts/     # Build and utility scripts\n\u251c\u2500\u2500 dev/               # Development environment files\n\u251c\u2500\u2500 docs/              # Documentation\n\u251c\u2500\u2500 scripts/           # Utility scripts\n\u2514\u2500\u2500 test/              # Test files\n    \u251c\u2500\u2500 integration/   # Integration tests\n    \u251c\u2500\u2500 unit/          # Unit tests\n    \u2514\u2500\u2500 utils/         # Test utilities\n</code></pre>"},{"location":"developer/backend/#available-poetry-scripts","title":"Available Poetry Scripts","text":"<p>The project defines several convenient scripts in <code>pyproject.toml</code>:</p> <ul> <li><code>poetry run server</code> - Start the Clue API server</li> <li><code>poetry run test</code> - Run the test suite</li> <li><code>poetry run type_check</code> - Run type checking</li> <li><code>poetry run coverage_report</code> - Generate coverage reports (must be run after <code>test</code>)</li> <li><code>poetry run plugin</code> - Interactive plugin management</li> </ul>"},{"location":"developer/backend/#configuration","title":"Configuration","text":""},{"location":"developer/backend/#environment-variables","title":"Environment Variables","text":"<p>The following environment variables can override configuration settings:</p> <ul> <li><code>CLUE_CONFIG_PATH</code> - Path to the main configuration file (default: <code>/etc/clue/conf/config.yml</code>)</li> <li><code>CLUE_CLASSIFICATION_PATH</code> - Path to the classification file (default: <code>/etc/clue/conf/classification.yml</code>)</li> <li><code>CLUE_PLUGIN_DIRECTORY</code> - Path to where clue extensions to the central API are stored (default: <code>/etc/clue/plugins</code>)</li> <li><code>CLUE_SESSION_COOKIE_SAMESITE</code> - Set SameSite attribute for session cookies. Must be <code>Strict</code>, <code>Lax</code>, or <code>None</code> for security</li> <li><code>CLUE_HSTS_MAX_AGE</code> - HTTP Strict Transport Security max-age value in seconds for enhanced HTTPS security</li> <li><code>FLASK_ENV</code> - Flask environment (development/production)</li> <li><code>FLASK_DEBUG</code> - Enable Flask debug mode</li> <li><code>REDIS_HOST</code> - Override Redis hostname</li> <li><code>REDIS_PORT</code> - Override Redis port</li> </ul>"},{"location":"developer/backend/#configuration-files","title":"Configuration Files","text":"<p>Clue uses two main configuration files:</p> <ul> <li><code>/etc/clue/conf/config.yml</code> - Main application configuration</li> <li><code>/etc/clue/conf/classification.yml</code> - Classification configuration</li> </ul>"},{"location":"developer/backend/#main-configuration-configyml","title":"Main Configuration (<code>config.yml</code>)","text":"<p>The main configuration file defines all aspects of the Clue API server. Here are the key sections:</p>"},{"location":"developer/backend/#api-configuration","title":"API Configuration","text":"<pre><code>api:\n  # Security settings\n  secret_key: \"your-secret-key-here\" # Flask secret key for sessions\n  session_duration: 3600 # Session duration in seconds (1 hour)\n  validate_session_ip: true # Validate session IP matches\n  validate_session_useragent: true # Validate session user agent matches\n  validate_session_xsrf_token: true # Enable XSRF token validation\n\n  # Debugging and auditing\n  debug: false # Enable Flask debug mode\n  audit: true # Log API calls for auditing\n\n  # Service discovery\n  discover_url: null # Optional service discovery URL\n\n  # External enrichment sources\n  external_sources: [] # List of external enrichment services\n\n  # OAuth on Behalf (OBO) targets\n  obo_targets: {} # Services that Clue can OBO to\n</code></pre>"},{"location":"developer/backend/#authentication-configuration","title":"Authentication Configuration","text":"<pre><code>auth:\n  # API Key authentication\n  allow_apikeys: false # Enable API key authentication\n  apikeys: # Map of API keys to user identifiers\n    \"api-key-1\": \"user1\"\n    \"api-key-2\": \"user2\"\n\n  # OAuth settings\n  oauth:\n    enabled: false # Enable OAuth authentication\n    gravatar_enabled: false # Enable Gravatar for user avatars\n    other_audiences: [] # Additional JWT audiences to accept\n    providers: {} # OAuth provider configurations\n\n  # Service account authentication\n  service_account:\n    enabled: false # Enable service account authentication\n    accounts: [] # List of service account credentials\n\n  # Token propagation\n  propagate_clue_key: true # Include Clue token in OBO requests\n</code></pre>"},{"location":"developer/backend/#core-services-configuration","title":"Core Services Configuration","text":"<pre><code>core:\n  # Redis configuration\n  redis:\n    host: \"127.0.0.1\" # Redis server hostname\n    port: 6379 # Redis server port\n\n  # Extensions to load\n  extensions: [] # List of Clue extensions to load\n\n  # Metrics collection\n  metrics:\n    export_interval: 5 # Metrics export interval in seconds\n    redis: # Redis instance for metrics\n      host: \"127.0.0.1\"\n      port: 6379\n    apm_server: # Application Performance Monitoring\n      server_url: null # APM server URL\n      token: null # APM authentication token\n</code></pre>"},{"location":"developer/backend/#logging-configuration","title":"Logging Configuration","text":"<pre><code>logging:\n  # Log levels: DEBUG, INFO, WARNING, ERROR, CRITICAL, DISABLED\n  log_level: \"DEBUG\" # Current log level\n\n  # Output destinations\n  log_to_console: true # Log to console/stdout\n  log_to_file: false # Log to files\n  log_to_syslog: false # Log to syslog server\n\n  # File logging settings\n  log_directory: \"/var/log/clue/\" # Directory for log files\n  log_as_json: false # Use JSON format for logs\n\n  # Syslog settings\n  syslog_host: \"localhost\" # Syslog server hostname\n  syslog_port: 514 # Syslog server port\n\n  # Health monitoring\n  heartbeat_file: null # File to touch for health checks\n  export_interval: 5 # Counter logging interval\n</code></pre>"},{"location":"developer/backend/#ui-configuration","title":"UI Configuration","text":"<pre><code>ui:\n  cors_origins: [] # Allowed CORS origins for web UI\n</code></pre>"},{"location":"developer/backend/#external-source-configuration","title":"External Source Configuration","text":"<p>When configuring external enrichment sources, each source supports these options:</p> <pre><code>api:\n  external_sources:\n    - name: \"example-source\" # Unique source name\n      url: \"https://api.example.com\" # Source API URL\n      classification: \"TLP:CLEAR\" # Minimum classification level\n      max_classification: \"TLP:RED\" # Maximum classification level\n      include_default: true # Include in default queries\n      production: false # Production-ready flag\n      default_timeout: 30 # Request timeout in seconds\n      built_in: true # Built-in source flag\n      maintainer: \"Admin &lt;admin@example.com&gt;\" # RFC-5322 contact\n      documentation_link: \"https://docs.example.com\" # Documentation URL\n      datahub_link: \"https://datahub.example.com\" # DataHub entry\n      obo_target: null # OBO target name\n</code></pre>"},{"location":"developer/backend/#oauth-provider-configuration","title":"OAuth Provider Configuration","text":"<p>For OAuth authentication, configure providers like this:</p> <pre><code>auth:\n  oauth:\n    enabled: true\n    providers:\n      keycloak:\n        client_id: \"clue-api\" # OAuth client ID\n        client_secret: \"your-client-secret\" # OAuth client secret\n        audience: \"clue-api\" # JWT audience\n        scope: \"openid profile email groups\" # OAuth scopes\n        jwks_uri: \"https://auth.example.com/realms/clue/protocol/openid-connect/certs\"\n        access_token_url: \"https://auth.example.com/realms/clue/protocol/openid-connect/token\"\n        authorize_url: \"https://auth.example.com/realms/clue/protocol/openid-connect/auth\"\n        api_base_url: \"https://auth.example.com/realms/clue/protocol/openid-connect\"\n\n        # User management\n        auto_create: true # Auto-create users\n        auto_sync: false # Auto-sync user data\n        required_groups: [\"clue-users\"] # Required OAuth groups\n\n        # Role and classification mapping\n        role_map: # Map OAuth groups to Clue roles\n          \"clue-admins\": \"admin\"\n          \"clue-analysts\": \"analyst\"\n        classification_map: # Map OAuth groups to clearance levels\n          \"clue-admins\": \"TLP:RED\"\n          \"clue-analysts\": \"TLP:AMBER\"\n\n        # User ID configuration\n        uid_randomize: false # Generate random usernames\n        uid_regex: \"^(.+)@example\\\\.com$\" # Extract username from email\n        uid_format: \"{0}\" # Username format string\n</code></pre>"},{"location":"developer/backend/#classification-configuration-classificationyml","title":"Classification Configuration (<code>classification.yml</code>)","text":"<p>The classification configuration defines the data classification system used by Clue. This file follows the Assemblyline classification engine format.</p> <p>For detailed information on configuring the classification engine, see the Assemblyline Classification Engine Documentation.</p> <p>Key aspects of classification configuration:</p> <ul> <li>Classification Levels: Define hierarchical classification levels (e.g., TLP:CLEAR, TLP:GREEN, TLP:AMBER, TLP:RED)</li> <li>Required Classifications: Specify minimum classification levels for different data types</li> <li>Enforcement Rules: Configure how classifications are enforced and propagated</li> <li>Marking Schemes: Define visual and textual markings for classified data</li> </ul> <p>Example basic classification configuration:</p> <pre><code>classification:\n  enforce: true\n  dynamic_groups: false\n  levels:\n    - TLP:CLEAR\n    - TLP:GREEN\n    - TLP:AMBER\n    - TLP:RED\n  required:\n    - TLP:CLEAR\n  groups:\n    - name: \"TLP\"\n      short_name: \"TLP\"\n      description: \"Traffic Light Protocol\"\n      auto_select: true\n</code></pre>"},{"location":"developer/backend/#configuration-validation","title":"Configuration Validation","text":"<p>Clue validates configuration against a JSON schema on startup. If configuration is invalid, the server will fail to start with descriptive error messages indicating which settings need correction.</p>"},{"location":"developer/backend/#docker-development","title":"Docker Development","text":""},{"location":"developer/backend/#building-the-docker-image","title":"Building the Docker Image","text":"<p>Build the development Docker image:</p> <pre><code>poetry build\ndocker build -t clue-api:dev .\n</code></pre>"},{"location":"developer/backend/#docker-compose-for-full-stack","title":"Docker Compose for Full Stack","text":"<p>The development environment uses Docker Compose to provide essential services for testing and development. The <code>api/dev/docker-compose.yml</code> file defines the following services:</p>"},{"location":"developer/backend/#redis-service","title":"Redis Service","text":"<pre><code>redis:\n  image: redis\n  ports:\n    - \"6379:6379\"\n  healthcheck:\n    test: [\"CMD\", \"redis-cli\", \"ping\"]\n    interval: 30s\n    timeout: 10s\n    retries: 3\n</code></pre> <p>Purpose: Redis serves as the caching layer and session store for Clue. It's used for:</p> <ul> <li>Session management and user authentication state</li> <li>Caching enrichment results to improve performance</li> <li>Rate limiting and quota management</li> <li>Metrics aggregation and temporary data storage</li> </ul> <p>Development Notes:</p> <ul> <li>Exposed on the standard port 6379</li> <li>Includes health checks to ensure the service is ready before tests run</li> <li>No persistence configured - data is lost when container stops (suitable for development)</li> </ul>"},{"location":"developer/backend/#keycloak-service-custom-build","title":"Keycloak Service (Custom Build)","text":"<pre><code>keycloak:\n  build:\n    context: ./keycloak\n    dockerfile: Dockerfile\n    no_cache: true\n  environment:\n    KC_HEALTH_ENABLED: true\n  ports:\n    - \"9100:8080\"\n  expose:\n    - \"9100\"\n  healthcheck:\n    test: [\"CMD-SHELL\", \"curl -f http://localhost:8080/health/ready\"]\n    interval: 5s\n    timeout: 5s\n    retries: 15\n</code></pre> <p>Purpose: Keycloak provides OAuth/OpenID Connect authentication services for testing authentication flows in Clue.</p> <p>Custom Dockerfile Features: The custom Keycloak image (<code>api/dev/keycloak/Dockerfile</code>) extends the official Keycloak 18.0.2 image with:</p> <ul> <li> <p>Pre-configured Admin Account:</p> </li> <li> <p>Username: <code>admin</code></p> </li> <li>Password: <code>admin</code></li> <li> <p>Allows immediate access to Keycloak admin console</p> </li> <li> <p>Development Mode: Runs in development mode with debug enabled for easier troubleshooting</p> </li> <li> <p>Pre-imported Realm: Automatically imports the included realm configuration from <code>keycloak-realm.json</code></p> </li> <li> <p>Enhanced Features: Enables token exchange and fine-grained authorization features that may be used by Clue</p> </li> </ul> <p>Pre-configured Test Users: The imported realm includes several test users for development and testing:</p> <ul> <li><code>admin</code> - Administrative user</li> <li><code>dewey</code>, <code>donald</code>, <code>goose</code> - Standard test users</li> <li><code>guest</code> - Guest user with limited permissions</li> <li><code>huey</code>, <code>louie</code> - Additional test users</li> </ul> <p>Realm Configuration Highlights: The <code>keycloak-realm.json</code> file configures a built-in realm with:</p> <ul> <li>Client Applications: Pre-configured OAuth clients for Clue API integration</li> <li>User Groups: Different user groups with varying permission levels</li> <li>Authentication Flows: Standard OAuth flows for web and API authentication</li> <li>Security Settings: Appropriate security headers and session management</li> <li>Internationalization: Support for English and French locales</li> <li>Token Lifespans: Configured for development (shorter lifespans for testing)</li> </ul>"},{"location":"developer/backend/#starting-the-development-stack","title":"Starting the Development Stack","text":"<p>To start all development services:</p> <pre><code>cd api/dev\ndocker-compose up --build -d\n</code></pre> <p>To verify services are healthy:</p> <pre><code># Check service status\ndocker-compose ps\n\n# Check logs if needed\ndocker-compose logs redis\ndocker-compose logs keycloak\n\n# Or use the built-in health check\npoetry run python build_scripts/keycloak_health.py\n</code></pre>"},{"location":"developer/backend/#accessing-services","title":"Accessing Services","text":"<ul> <li>Redis: Available at <code>localhost:6379</code> (no authentication required)</li> <li>Keycloak Admin Console: <code>http://localhost:9100/admin</code></li> <li>Username: <code>admin</code></li> <li>Password: <code>admin</code></li> <li>Keycloak Realm: <code>http://localhost:9100/realms/HogwartsMini</code></li> </ul>"},{"location":"developer/backend/#stopping-and-cleaning-up","title":"Stopping and Cleaning Up","text":"<pre><code># Stop services\ndocker-compose down\n\n# Stop and remove volumes (clean slate)\ndocker-compose down -v\n\n# Rebuild from scratch\ndocker-compose down -v &amp;&amp; docker-compose up --build\n</code></pre>"},{"location":"developer/backend/#integration-with-clue-api","title":"Integration with Clue API","text":"<p>When the Clue API is configured for OAuth authentication, it can connect to the local Keycloak instance using:</p> <pre><code>auth:\n  oauth:\n    enabled: true\n    providers:\n      keycloak:\n        client_id: \"clue-api\"\n        jwks_uri: \"http://localhost:9100/realms/HogwartsMini/protocol/openid-connect/certs\"\n        access_token_url: \"http://localhost:9100/realms/HogwartsMini/protocol/openid-connect/token\"\n        authorize_url: \"http://localhost:9100/realms/HogwartsMini/protocol/openid-connect/auth\"\n        api_base_url: \"http://localhost:9100/realms/HogwartsMini/protocol/openid-connect\"\n        # ... other configuration\n</code></pre> <p>This setup provides a complete development environment for testing authentication, authorization, caching, and all Clue API functionality without requiring external services.</p>"},{"location":"developer/backend/#troubleshooting","title":"Troubleshooting","text":""},{"location":"developer/backend/#environment-issues","title":"Environment Issues","text":"<p>If you encounter issues with the Python environment:</p> <ol> <li>Delete the existing environment: <code>poetry env remove python</code></li> <li>Recreate it: <code>poetry env use 3.12</code></li> <li>Reinstall dependencies: <code>poetry install --all-extras --with test,dev,types</code></li> </ol>"},{"location":"developer/backend/#service-dependencies","title":"Service Dependencies","text":"<p>If Docker services aren't starting properly:</p> <ol> <li>Stop all containers: <code>docker-compose down</code></li> <li>Remove volumes: <code>docker-compose down -v</code></li> <li>Rebuild: <code>docker-compose up --build</code></li> </ol>"},{"location":"developer/backend/#additional-resources","title":"Additional Resources","text":"<ul> <li>Poetry Documentation</li> <li>Ruff Documentation</li> <li>pytest Documentation</li> <li>Flask Documentation</li> </ul>"},{"location":"developer/backend/#contributing","title":"Contributing","text":"<p>See Contributing for general information on how to contribute.</p> <p>In addition to the standard contributing practices, here are some additional guidelines specific to the Clue API project:</p>"},{"location":"developer/backend/#pre-commit-hooks","title":"Pre-commit Hooks","text":"<p>Install pre-commit hooks to automatically run checks before commits:</p> <pre><code>poetry run pre-commit install\n</code></pre>"},{"location":"developer/backend/#pre-submission-checks","title":"Pre-submission Checks","text":""},{"location":"developer/backend/#before-opening-a-pr-ensure","title":"Before opening a PR, ensure:","text":"<ul> <li>All tests pass: <code>poetry run test</code></li> <li>Code is properly formatted: <code>poetry run ruff format clue</code></li> <li>Linting passes: <code>poetry run ruff check clue</code></li> <li>Type checking passes: <code>poetry run type_check</code></li> </ul> <p>Note that installing pre-commit hooks will also help handle these cases.</p>"},{"location":"developer/backend/#getting-help","title":"Getting Help","text":"<p>You can reach the Clue developemnt team on the CCCS aurora discord: https://discord.gg/GUAy9wErNu</p>"},{"location":"developer/frontend/","title":"Clue UI Development Guide","text":""},{"location":"developer/frontend/#clue-ui-development-guide","title":"Clue UI Development Guide","text":"<p>This guide outlines how to set up a development environment for the Clue UI.</p>"},{"location":"developer/frontend/#prerequisites","title":"Prerequisites","text":"<p>Before you begin, ensure you have the following installed on your system:</p> <ul> <li>Python 3.10, 3.11, or 3.12 (3.12 recommended) (used in build_scripts )</li> <li>Node/NPM (Recommended to be installed using NVM)</li> <li>PNPM</li> <li>Git</li> </ul>"},{"location":"developer/frontend/#development-environment-setup","title":"Development Environment Setup","text":""},{"location":"developer/frontend/#1-clone-the-repository","title":"1. Clone the Repository","text":"<pre><code>git clone https://github.com/CybercentreCanada/clue.git\ncd clue/ui\n</code></pre>"},{"location":"developer/frontend/#2-install-nodenpm-using-nvm","title":"2. Install Node/NPM using NVM","text":"<p>If you don't have NPM installed, follow the official installation guide.</p> <p>Verify NPM installation:</p> <pre><code>npm --version\n</code></pre>"},{"location":"developer/frontend/#3-install-pnpm-using-npm","title":"3. Install PNPM using NPM","text":"<p>This project uses PNPM to manage dependencies, since it's faster than the default NPM (and corporate proxy networks can be quite slow).</p> <p>PNPM can simply be installed using NPM: </p><pre><code>npm install -g pnpm\n</code></pre><p></p>"},{"location":"developer/frontend/#4-install-project-dependencies-using-pnpm","title":"4. Install Project Dependencies using PNPM","text":"<p>Now that PNPM is installed, you can install the project dependencies:</p> <pre><code>pnpm install\n</code></pre> <p>This will install all dependencies in the node_modules directory.</p>"},{"location":"developer/frontend/#development-workflow","title":"Development Workflow","text":""},{"location":"developer/frontend/#starting-the-development-server","title":"Starting the Development Server","text":"<p>Start the Clue UI in dev mode:</p> <pre><code>pnpm dev\n</code></pre>"},{"location":"developer/frontend/#running-tests","title":"Running Tests","text":"<p>Run tests:</p> <pre><code>pnpm test\n</code></pre> <p>You can also run tests with a prettier terminal UI using this command:</p> <pre><code>pnpm test-ui\n</code></pre>"},{"location":"developer/frontend/#additional-scripts","title":"Additional scripts","text":"<p>For more launch options, see the \"scripts\" section of the package.json file.</p>"},{"location":"developer/frontend/#troubleshooting","title":"Troubleshooting","text":""},{"location":"developer/frontend/#getting-help","title":"Getting Help","text":"<p>You can reach the Clue developemnt team on the CCCS aurora discord: https://discord.gg/GUAy9wErNu</p>"},{"location":"developer/getting_started/","title":"Getting Started","text":""},{"location":"developer/getting_started/#getting-started","title":"Getting Started","text":""},{"location":"developer/getting_started/#integrating-your-plugin-into-clue-responsibilities-and-expectations","title":"Integrating Your Plugin into Clue - Responsibilities and Expectations","text":"<p>Since clue is a fairly complex project with a fair number of moving parts, it's important to outline the responsibilities of the various stakeholders:</p> <ol> <li>APA2B is the primary code-owner of the core clue-api code (i.e., all code inside the <code>clue/</code> folder).</li> <li>Each respective team is responsible for maintenance and evolution of their specific plugin.</li> <li>Each respective team is responsible for ensuring compatibiliy between their plugin and the central API.</li> <li>This includes adapting to breaking changes introduced during development of the core clue service.</li> <li>APA2B will try its best to limit these breaking changes as much as possible, and give plenty of notice.</li> <li>APA2B is available for support with development (asking questions, fixing bugs in the central service, etc.).</li> <li>APA2B is responsible for maintaining the stability of the service as a whole.</li> </ol>"},{"location":"developer/getting_started/#integrating-your-plugin-into-clue-hosting-the-code","title":"Integrating Your Plugin into Clue - Hosting the Code","text":"<p>When building a plugin, the first step is to decide where the code will be stored you have two options for hosting the code:</p>"},{"location":"developer/getting_started/#including-the-plugin-in-the-repo","title":"Including the plugin in the repo","text":"<p>This approach allows you to develop the plugin, including it in the build process for clue, ensuring it is tightly integrated with schema changes and feature updates top the base clue packages. This allows clue devs to test your plugin for compatibility, and currently is the recommended approach.</p> <p>Note: Only python plugins are currently supported this way!</p> <p>The first step is to create a folder for your application in the plugins directory. You can use the clue example template to do so, or copy an existing plugin depending on your preferences.</p> <p>Once you have finished development of the core features, it is strongly recommended that you write at least very basic unit tests for your plugin, with the gold standard being full integration testing against mock data. For inspiration, check existing plugins and their test regimes.</p> <p>You must additionally add an entry to the <code>azure-pipelines.yml</code> file in the root of the project for your application.</p> <p>For detailed information on initializing tests, see our main README file. For further support, reach out to APA2B.</p>"},{"location":"developer/getting_started/#external-dependencies","title":"External dependencies","text":"<p>If you import external packages differing from the plugin template, you must specify them both in the <code>requirements.txt</code> file of your plugin, and in plugin dependencies group of the poetry project. The following command can do so:</p> <pre><code># Replace the dependencies here with yours\npoetry add -G plugins azure-core 'azure-storage-blob&gt;=12.2.0' 'azure-storage-file-datalake&gt;=12.2.0'\n</code></pre>"},{"location":"developer/getting_started/#creating-a-pull-request","title":"Creating a Pull Request","text":"<p>Once you are satisfied with your plugin, create a pull request for a member of APA2B to review the plugin for final approval. There are some code quality checks performed on the codebase - if issues are flagged, work with a member of APA2B to resolve them. Only readability and compatibility checks are the responsibility of APA2B - we do not have any say on the functionality of your plugin, and cannot assist in development of your plugin beyond questions about the base clue codebase.</p>"},{"location":"developer/getting_started/#standalone-repo","title":"Standalone repo","text":"<p>If you find our code standards too strict or insufficient, or want to develop the plugin in a language other than python, or simply don't want to be included in the repository, you are welcome to host, test and build the plugin in a standalone repository. We recommend running integration tests with a copy of the clue API to ensure compatibility.</p>"},{"location":"developer/getting_started/#deploying-the-plugin","title":"Deploying the plugin","text":"<p>Currently, deployment of plugins in the enrichment namespace is the responsibility of APA2B - there are no resources to allow developers to manually deploy and remove their plugins. However, the plugin can exist anywhere that the central clue API can reach, so it's not a requirement to deploy it in that namespace.</p> <p>If your code is hosted in this repo, APA2B will assist in configuring and deploying your plugin when it is ready for production. There are plans to allow improved management of plugins, including deployment to the enrichment namespace without the intervention of APA2B, but this will take some time to implement and the work is not currently scheduled.</p>"},{"location":"developer/getting_started/#registering-the-plugin","title":"Registering the plugin","text":"<p>If you host your plugin's code in this repo, building the image and deploying it will be the responsibility of APA2B - otherwise, it is the responsibility of the developers of the plugin.</p> <p>Currently, registration of plugins with the central clue API is predominantly handled through configuration files in the helm chart. There is support for registering plugins at runtime, but it is fairly basic - reach out to APA2B if you are interested in runtime registration.</p>"},{"location":"developer/plugin/","title":"Creating a new Clue Plugin","text":""},{"location":"developer/plugin/#creating-a-new-clue-plugin","title":"Creating a new Clue Plugin","text":"<p>This document will walk you through developing, publishing and deploying a new Clue plugin.</p>"},{"location":"developer/plugin/#development-environment-setup","title":"Development Environment Setup","text":""},{"location":"developer/plugin/#installing-poetry","title":"Installing poetry","text":"<pre><code>pip install poetry\ncd clue-api\npoetry install --with dev,test --all-extras\n\n# OPTIONAL: Instead pre-commit hooks (black/flake8/isort formatting)\npoetry run pre-commit install\n\n# Now you can run the clue server!\npoetry run server\n</code></pre>"},{"location":"developer/plugin/#useful-commands","title":"Useful Commands","text":"<p>To activate a venv, use <code>poetry shell</code>.</p> <p>To add a new dependency, use <code>poetry add</code>:</p> <pre><code>\u279c  clue-api git:(poetry) poetry add pyjwt\nUsing version ^2.8.0 for pyjwt\n\nUpdating dependencies\nResolving dependencies... (0.5s)\n\nPackage operations: 1 install, 0 updates, 0 removals\n\n  - Installing pyjwt (2.8.0)\n\nWriting lock file\n</code></pre> <p>Then commit the new <code>pyproject.toml</code> and <code>poetry.lock</code>.</p>"},{"location":"developer/plugin/#setup-clue-folders-and-configuration","title":"Setup Clue Folders and Configuration","text":"<pre><code># Clue config.yml should be in this location, as well as classification.yml\n# For a starter config, use the test config.yml and classification.\nsudo mkdir -p /etc/clue/conf\n# Log file directory, will write log files here if enabled\nsudo mkdir -p /var/log/clue\n\nsudo chown -R $USER /etc/clue\nsudo chown $USER /var/log/clue\n</code></pre>"},{"location":"developer/plugin/#creating-the-plugin","title":"Creating the plugin","text":"<p>The easiest way to create a plugin is to use the Interactive Wizard. This script can be found at plugins/setup/create.py Simply run the python script and it will prompt you for required info: </p><pre><code>python plugins/setup/create.py\n</code></pre><p></p>"},{"location":"developer/plugin/#interacting-with-the-central-api","title":"Interacting with the central API","text":""},{"location":"developer/plugin/#request-initiation","title":"Request Initiation","text":"<p>Various client applications can make requests to the central API, which will in turn proxy requests to every relevant registered plugin.</p> <p></p>"},{"location":"developer/plugin/#response","title":"Response","text":"<p>The responses from each plugin are then merged together and returned with some metadata to the client application.</p> <p></p>"},{"location":"developer/plugin/#valid-plugin-operations","title":"Valid Plugin Operations","text":""},{"location":"developer/plugin/#enrichment","title":"Enrichment","text":"<p>Enrichments are a bread and butter of Clue. This entails the user requesting enrichment information about a given selector by making a network call to the central API, like this:</p> <pre><code># Enriching a single selector\nres = requests.get(\n    f\"{host}/api/v1/lookup/enrich/ip/127.0.0.1\",\n    params={\"max_timeout\": 2.0},\n    headers={\"Authorization\": f\"Bearer {access_token}\"},\n)\n\n# Bulk enrichment of selectors\nbulk_req = [{\"type\": \"ip\", \"value\": \"127.0.0.1\"}, {\"type\": \"ip\", \"value\": \"127.0.0.2\"}]\n\nres = requests.post(\n    f\"{host}/api/v1/lookup/enrich\",\n    params={\"max_timeout\": 5.0, \"sources\": \"test|bad\"},\n    headers={\"Authorization\": f\"Bearer {access_token}\"},\n    json=bulk_req,\n)\n</code></pre> <p>For a single enrichment, the response body will be a <code>QueryResult</code>:</p> QueryResult Example <pre><code>{\n  \"type\": \"ip\",\n  \"value\": \"127.0.0.1\",\n  \"source\": \"example_plugin\",\n  \"error\": null,\n  \"items\": [\n    {\n      \"classification\": \"TLP:CLEAR\",\n      \"count\": 23,\n      \"link\": \"https://example.com/moreinfo\",\n      \"annotations\": [\n        {\n          \"analytic\": \"Assemblyline\",\n          \"analytic_icon\": \"material-symbols:sound-detection-dog-barking\",\n          \"author\": null,\n          \"quantity\": 10,\n          \"version\": \"1.0.0\",\n          \"timestamp\": \"2024-12-16T12:54:26.374945+00:00\",\n          \"type\": \"context\",\n          \"value\": \"suspect\",\n          \"confidence\": 0.0,\n          \"severity\": 0.0,\n          \"priority\": 50.0,\n          \"summary\": \"Example summary of the information in this Annotation\",\n          \"details\": \"# Here's some annotation details\\\\n\\\\nIt's very interesting\",\n          \"link\": \"https://example.com/annotation\",\n          \"icon\": null,\n          \"ubiquitous\": true\n        },\n        {\n          \"analytic\": \"Howler\",\n          \"analytic_icon\": null,\n          \"author\": null,\n          \"quantity\": 10,\n          \"version\": \"v0.0.1\",\n          \"timestamp\": \"2024-12-30T12:54:26.374940+00:00\",\n          \"type\": \"context\",\n          \"value\": \"benign\",\n          \"confidence\": 1.0,\n          \"severity\": 1.0,\n          \"priority\": 50.0,\n          \"summary\": \"Example summary of the information in this Annotation\",\n          \"details\": null,\n          \"link\": \"https://example.com/annotation\",\n          \"icon\": null,\n          \"ubiquitous\": true\n        },\n        {\n          \"analytic\": \"Assemblyline\",\n          \"analytic_icon\": null,\n          \"author\": \"John Smith\",\n          \"quantity\": 25,\n          \"version\": \"1.0.0\",\n          \"timestamp\": \"2024-12-30T12:54:26.374940+00:00\",\n          \"type\": \"mitigation\",\n          \"value\": 42.0,\n          \"confidence\": 0.0,\n          \"severity\": 0.5,\n          \"priority\": 50.0,\n          \"summary\": \"Example summary of the information in this Annotation\",\n          \"details\": \"# Here's some annotation details\\\\n\\\\nIt's very interesting\",\n          \"link\": null,\n          \"icon\": null,\n          \"ubiquitous\": false\n        }\n      ],\n      \"raw_data\": {\n        \"id\": 1,\n        \"raw_field\": \"some_data\"\n      }\n    },\n    {\n      \"classification\": \"TLP:CLEAR\",\n      \"count\": 9,\n      \"link\": null,\n      \"annotations\": [\n        {\n          \"analytic\": \"Howler\",\n          \"analytic_icon\": \"material-symbols:sound-detection-dog-barking\",\n          \"author\": null,\n          \"quantity\": 10,\n          \"version\": null,\n          \"timestamp\": \"2024-12-16T12:54:26.374945+00:00\",\n          \"type\": \"frequency\",\n          \"value\": 42.0,\n          \"confidence\": 0.5,\n          \"severity\": 0.0,\n          \"priority\": 50.0,\n          \"summary\": \"Example summary of the information in this Annotation\",\n          \"details\": null,\n          \"link\": \"https://example.com/annotation\",\n          \"icon\": null,\n          \"ubiquitous\": true\n        },\n        {\n          \"analytic\": null,\n          \"analytic_icon\": null,\n          \"author\": \"John Smith\",\n          \"quantity\": 25,\n          \"version\": \"v0.0.1\",\n          \"timestamp\": \"2024-12-30T12:54:26.374940+00:00\",\n          \"type\": \"context\",\n          \"value\": \"Involved in Operation Cat\",\n          \"confidence\": 1.0,\n          \"severity\": 0.5,\n          \"priority\": 1.0,\n          \"summary\": \"Example summary of the information in this Annotation\",\n          \"details\": null,\n          \"link\": \"https://example.com/annotation\",\n          \"icon\": null,\n          \"ubiquitous\": false\n        }\n      ],\n      \"raw_data\": [\n        {\n          \"id\": 1,\n          \"other_data\": \"example\",\n          \"other_row\": 45\n        }\n      ]\n    },\n    {\n      \"classification\": \"TLP:CLEAR\",\n      \"count\": 23,\n      \"link\": \"https://example.com/moreinfo\",\n      \"annotations\": [\n        {\n          \"analytic\": \"Howler\",\n          \"analytic_icon\": null,\n          \"author\": \"John Smith\",\n          \"quantity\": 25,\n          \"version\": \"v0.0.1\",\n          \"timestamp\": \"2024-12-30T12:54:26.374940+00:00\",\n          \"type\": \"context\",\n          \"value\": \"Involved in Operation Cat\",\n          \"confidence\": 1.0,\n          \"severity\": null,\n          \"priority\": 1000.0,\n          \"summary\": \"Example summary of the information in this Annotation\",\n          \"details\": null,\n          \"link\": null,\n          \"icon\": null,\n          \"ubiquitous\": false\n        },\n        {\n          \"analytic\": null,\n          \"analytic_icon\": null,\n          \"author\": null,\n          \"quantity\": 25,\n          \"version\": null,\n          \"timestamp\": \"2024-12-16T12:54:26.374945+00:00\",\n          \"type\": \"frequency\",\n          \"value\": 42.0,\n          \"confidence\": 0.0,\n          \"severity\": null,\n          \"priority\": 1000.0,\n          \"summary\": \"Example summary of the information in this Annotation\",\n          \"details\": \"# Here's some annotation details\\\\n\\\\nIt's very interesting\",\n          \"link\": null,\n          \"icon\": null,\n          \"ubiquitous\": true\n        }\n      ],\n      \"raw_data\": {\n        \"id\": 1,\n        \"raw_field\": \"some_data\"\n      }\n    }\n  ],\n  \"maintainer\": null,\n  \"datahub_link\": \"https://example.com/datahub\",\n  \"documentation_link\": null,\n  \"latency\": 1470\n}\n</code></pre> <p>A bulk enrichment will return the data in a dict of dicts of a list of <code>QueryResult</code>s, where the first key is the type and the second key is the value:</p> <pre><code>{\n    \"ip\": {\n        \"127.0.0.1\": [\n            // See above for a full query result example\n            {\n                \"type\": \"ip\",\n                \"value\": \"127.0.0.1\",\n                \"source\": \"example_plugin\",\n                ...\n            }\n        ]\n    }\n}\n</code></pre> <p>However, this formatting is handled by the central API and the Clue plugin for the most part.</p>"},{"location":"developer/plugin/#actions","title":"Actions","text":"<p>Actions are operations a plugin can perform on either a single or several selectors. For example, an action could add a selector to a database somewhere for tracking purposes, return a markdown summary of refined results for a set of selectors, or any other arbitrary action. Clue only enforces the format of the response - there are no restrictions on what an action can do.</p> <p>In order to execute an action, the user must send an execution request to the central API:</p> <pre><code>res = requests.post(\n    f\"{host}/api/v1/actions/execute/example/example_action\",\n    params={\"max_timeout\": 2.0},\n    headers={\"Authorization\": f\"Bearer {access_token}\"},\n    json={\"selector\": {\"type\": \"ip\", \"value\": \"127.0.0.1\"}, \"other_choice\": \"b\"},\n)\n</code></pre> <p>You'll note the additional field provided. We will explain that next.</p>"},{"location":"developer/plugin/#additional-parameters","title":"Additional Parameters","text":"<p>Clue plugins that expose an action can request additional parameters from the user in order to provide context of the action request to the plugin. These parameters can be declared on the plugin side, and the Clue UI library will handle gathering the additional parameters.</p> <p>Additional parameters are specified using Python Generics and class inheritance. Here is an example corresponding to the above request:</p> <pre><code>class Params(ExecuteRequest):\n    other_value: Optional[str] = Field(description=\"Another field you should show\", default=\"\")\n    choice: ChoiceEnum = Field(default=ChoiceEnum.a, description=\"Another choice for you\")\n    other_choice: ChoiceEnum = Field(description=\"Another choice for you with no default\")\n\nplugin = CluePlugin(\n    ...,\n    actions=[\n        Action[Params](\n            id=\"test_action\",\n            action_icon=\"codicon:terminal\",\n            name=\"Test Action\",\n            classification=\"TLP:CLEAR\",\n            summary=\"Tester\",\n            supported_types={\"ip\", \"port\", \"sha256\"},\n            accept_multiple=True,\n        )\n    ]\n)\n</code></pre> <p>Note that parameters can be marked as optional, as is shown above - only <code>other_choice</code> is fully required.</p>"},{"location":"developer/plugin/#action-results","title":"Action Results","text":"<p>In order to notify the user on the outcome of the action, actions are expected to return an <code>ActionResult</code> model. This allows for a short description of the outcome, the output of the action (along with a format) as well as a status enum:</p> <pre><code>failed_example = ActionResult(\n    outcome=\"failure\",\n    summary=\"Action failed.\",\n    format=\"markdown\",\n    output=textwrap.dedent(\n        f\"\"\"\n        # Action Failed\n\n        Retaining your data was unsuccessful for an unknown reason.\n\n        ## Error Message:\n\n        {str(e)}\n        \"\"\".strip()\n    ),\n)\n\nsuccess_example = ActionResult(\n    outcome=\"success\",\n    summary=\"Action Completed Successfully\",\n    format=\"json\",\n    output={\n        \"example\": \"result\"\n    },\n    link=Url(\"http://example.com\"),\n)\n</code></pre>"},{"location":"developer/plugin/#fetchers","title":"Fetchers","text":"<p>Fetchers are a way for plugins to return data to the client to be displayed based on a selector. This data can be returned in any support format - currently:</p> <ul> <li>Markdown</li> <li>Json</li> <li>Images</li> </ul> <p>Fetchers function similarly to actions, except no additional information can be provided. Below is an example of a fetcher implementation:</p> <pre><code>def run_fetcher(fetcher: FetcherDefinition, selector: Selector, access_token: str | None) -&gt; FetcherResult:\n    \"Fetch a rendering of the given email\"\n    try:\n        if not access_token:\n            return FetcherResult(outcome=\"failure\", format=\"error\", error=\"Missing access token.\")\n\n            # work here\n\n            return FetcherResult(\n                outcome=\"success\",\n                format=\"image\",\n                data=ImageResult(\n                    image=f\"data:image/png;base64,{base64.b64encode(image_data).decode(\"utf-8\")}\",\n                    alt=f\"Rendering of an image to do with the given selector\",\n                ),\n            )\n    except Exception as e:\n        logger.exception(\"Error in run_fetcher\")\n        return FetcherResult.error_result(repr(e))\n\nplugin = CluePlugin(\n    ...,\n    run_fetcher=run_fetcher,\n)\n</code></pre>"},{"location":"developer/plugin/#building-the-docker-image","title":"Building the docker image","text":""},{"location":"installation/helm/","title":"Kubernetes Deployment Guide (using Helm)","text":""},{"location":"installation/helm/#kubernetes-deployment-guide-using-helm","title":"Kubernetes Deployment Guide (using Helm)","text":"<p>This document provides guidance for deploying and managing Clue on a Kubernetes cluster.</p>"},{"location":"installation/helm/#overview","title":"Overview","text":"<p>In this repository, a helm chart is provided that will allow you to deploy Clue to a Kubernetes cluster.</p>"},{"location":"installation/helm/#requirements","title":"Requirements","text":"<p>In order to deploy Clue to a Kubernetes cluster, you'll need to install kubectl as well as helm to install the provided helm chart.</p>"},{"location":"installation/helm/#installing-kubectl","title":"Installing Kubectl","text":"<p>If you don't have Kubectl installed, follow the official installation guide.</p> <p>Verify kubectl installation:</p> <pre><code>kubectl version\n</code></pre>"},{"location":"installation/helm/#installing-helm-and-helm-diff","title":"Installing Helm and Helm-diff","text":"<p>If you don't have Helm installed, follow the official installation guide.</p> <p>Verify helm installation:</p> <pre><code>helm version\n</code></pre> <p>It's also recommended (but not mandatory) to use helm-diff, follow the official installation guide</p> <p>Verify helm-diff installation:</p> <pre><code>helm diff version\n</code></pre>"},{"location":"installation/helm/#deployment","title":"Deployment","text":"<p>Here are the steps to deploying Clue to your own cluster:</p>"},{"location":"installation/helm/#1-creating-the-clue-namespace","title":"1. Creating the clue namespace","text":"<p>You'll probably want to install Clue in it's own namespace, and so before installing the chart, you'll need to create the namespace using kubectl. Here we're creating a namespace called <code>clue</code></p> <pre><code>kubectl create namespace clue\n</code></pre>"},{"location":"installation/helm/#2-creating-required-secrets","title":"2. Creating required secrets","text":"<p>You'll need to generate and store some secrets in the cluster:  - flask-secret-key  - clue-apikeys</p> <p>First, the <code>flask-secret-key</code> secret is a randomly generated password, here's a command to generate a 32 character password: </p><pre><code>tr -dc 'A-Za-z0-9!\"#$%&amp;()*+,-./:;&lt;=&gt;?@[\\\\]^_`{|}~' &lt; /dev/urandom | head -c 32\n</code></pre> As for the <code>clue-apikeys</code>, it expects a json object containing the API Keys that will allow plugins to connect to the core API. Here's what that would look like: <pre><code>{\n  \"my_plugin\": \"some_api_key\"\n}\n</code></pre> If you don't need any API Keys, you can simply insert an empty json object <code>{}</code>.<p></p> <p>Here's the command to create those secrets using kubectl: </p><pre><code>kubectl create secret generic flask-secret-key -n clue --from-literal=key=&lt;generated-password&gt;\nkubectl create secret generic clue-apikeys -n clue --from-literal=data={}\n</code></pre><p></p>"},{"location":"installation/helm/#3-creating-your-deployment-specific-values-file","title":"3. Creating your deployment-specific values file","text":"<p>In order to have deployment specific values, you'll need to create a new values-\\.yaml file. This file doesn't necessarily need to live in this repo, but it needs to be accessible to helm.</p> <p>In this file, you'll be able to override values from the values.yaml file by keeping the same structure. For example, if you want to use a different image tag for the UI and API deployments: </p><pre><code>images:\n  ui:\n    tag: &lt;your-tag-here&gt;\n  rest:\n    tag: &lt;your-tag-here&gt;\n</code></pre><p></p>"},{"location":"installation/helm/#4-installing-the-helm-chart","title":"4. Installing the helm chart","text":"<p>Here's a command that will install the helm chart, using <code>clue</code> as the deployment name, and deploying to the <code>clue</code> namespace:</p> <pre><code># helm install &lt;deployment-name&gt; -n &lt;namespace&gt; &lt;path-to-chart-directory&gt; --values &lt;path-to-deployment-specific-values&gt;\nhelm install clue -n clue helm/ --values helm/values/values.yaml --values helm/values/values-deployment.yaml\n</code></pre>"},{"location":"installation/helm/#5-updating-the-deployment","title":"5. Updating the deployment","text":"<p>Once the chart is installed, if you need to change anything in the deployment, you can run the same command, replacing the <code>install</code> option with <code>upgrade</code>.</p> <pre><code>helm upgrade clue -n clue helm/ --values helm/values/values.yaml --values helm/values/values-deployment.yaml\n</code></pre>"},{"location":"installation/helm/#pre-deployment-verification","title":"Pre-deployment Verification","text":"<p>Before deploying changes, it is recommended to verify that your local repository state matches the live cluster configuration using <code>helm diff</code>:</p> <pre><code># the -C 3 option limits the output to 3 lines on each side of each diff. Remove the option to see the entire file\nhelm diff upgrade clue -C 3 -n clue helm/ --values helm/values/values.yaml --values helm/values/values-deployment.yaml\n</code></pre> <p>If the diff shows unintended changes, review and revert them before proceeding with deployment.</p>"},{"location":"installation/helm/#expected-diff-output","title":"Expected Diff Output","text":""},{"location":"installation/helm/#normal-tls-certificate-changes","title":"Normal TLS Certificate Changes","text":"<p>When running diffs, you may notice changes to TLS certificates for the Elasticsearch APM server. These changes are expected and can be safely ignored as they do not affect API functionality.</p> <p>The following example demonstrates a typical diff output:</p> <pre><code>helm diff upgrade clue -C 3 -n clue helm/ --values helm/values/values.yaml --values helm/values/values-deployment.yaml\n</code></pre> <p>Sample output:</p> <pre><code>clue, clue-elasticsearch-coordinating, StatefulSet (apps) has changed:\n...\n          ## Istio Labels: https://istio.io/docs/ops/deployment/requirements/\n          app: coordinating-only\n        annotations:\n-         checksum/tls: 3cec91754cb7d9e1b8942941ba7885f20a604e0fef9c0200e569aaa46aca4b76\n+         checksum/tls: b3943b1a6b7e399be8961b11b17fc849b4ebb439e0b4f9bcadb71da90584e356\n      spec:\n        serviceAccountName: clue-elasticsearch-coordinating\n\n...\nclue, clue-elasticsearch-coordinating-crt, Secret (v1) has changed:\n...\n    name: clue-elasticsearch-coordinating-crt\n    namespace: clue\n  data:\n-   ca.crt: '-------- # (1147 bytes)'\n-   tls.crt: '-------- # (1590 bytes)'\n-   tls.key: '-------- # (1679 bytes)'\n+   ca.crt: '++++++++ # (1147 bytes)'\n+   tls.crt: '++++++++ # (1590 bytes)'\n+   tls.key: '++++++++ # (1679 bytes)'\n  type: kubernetes.io/tls\n\nclue, clue-elasticsearch-data, StatefulSet (apps) has changed:\n...\n          ## Istio Labels: https://istio.io/docs/ops/deployment/requirements/\n          app: data\n        annotations:\n-         checksum/tls: 3cec91754cb7d9e1b8942941ba7885f20a604e0fef9c0200e569aaa46aca4b76\n+         checksum/tls: c27f6015bf1a57310ca320b54c9f704236d12225f76bee2ff6c0074c58acf277\n      spec:\n        serviceAccountName: clue-elasticsearch-data\n\n...\nclue, clue-elasticsearch-data-crt, Secret (v1) has changed:\n...\n    name: clue-elasticsearch-data-crt\n    namespace: clue\n  data:\n-   ca.crt: '-------- # (1147 bytes)'\n-   tls.crt: '-------- # (1432 bytes)'\n-   tls.key: '-------- # (1679 bytes)'\n+   ca.crt: '++++++++ # (1147 bytes)'\n+   tls.crt: '++++++++ # (1432 bytes)'\n+   tls.key: '++++++++ # (1675 bytes)'\n  type: kubernetes.io/tls\n\nclue, clue-elasticsearch-ingest, StatefulSet (apps) has changed:\n...\n          ## Istio Labels: https://istio.io/docs/ops/deployment/requirements/\n          app: ingest\n        annotations:\n-         checksum/tls: 3cec91754cb7d9e1b8942941ba7885f20a604e0fef9c0200e569aaa46aca4b76\n+         checksum/tls: 82df1f98f3aa097dcf3e0c69bf7a3265b6c585180716596b12967300a389ef71\n      spec:\n        serviceAccountName: clue-elasticsearch-ingest\n\n...\nclue, clue-elasticsearch-ingest-crt, Secret (v1) has changed:\n...\n    name: clue-elasticsearch-ingest-crt\n    namespace: clue\n  data:\n-   ca.crt: '-------- # (1147 bytes)'\n-   tls.crt: '-------- # (1444 bytes)'\n-   tls.key: '-------- # (1679 bytes)'\n+   ca.crt: '++++++++ # (1147 bytes)'\n+   tls.crt: '++++++++ # (1444 bytes)'\n+   tls.key: '++++++++ # (1679 bytes)'\n  type: kubernetes.io/tls\n\nclue, clue-elasticsearch-master, StatefulSet (apps) has changed:\n...\n          ## Istio Labels: https://istio.io/docs/ops/deployment/requirements/\n          app: master\n        annotations:\n-         checksum/tls: 3cec91754cb7d9e1b8942941ba7885f20a604e0fef9c0200e569aaa46aca4b76\n+         checksum/tls: efbcb4453b92715929edd33d2ba61882ef7bfde053056c0f3d794c51a01b8364\n      spec:\n        serviceAccountName: clue-elasticsearch-master\n\n...\nclue, clue-elasticsearch-master-crt, Secret (v1) has changed:\n...\n    name: clue-elasticsearch-master-crt\n    namespace: clue\n  data:\n-   ca.crt: '-------- # (1147 bytes)'\n-   tls.crt: '-------- # (1444 bytes)'\n-   tls.key: '-------- # (1675 bytes)'\n+   ca.crt: '++++++++ # (1147 bytes)'\n+   tls.crt: '++++++++ # (1444 bytes)'\n+   tls.key: '++++++++ # (1675 bytes)'\n  type: kubernetes.io/tls\n\nclue, tree-viewer, Deployment (apps) has changed:\n...\n          null\n        containers:\n        - name: tree-viewer\n-         image: \"tree-viewer-plugin:develop\"\n+         image: \"tree-viewer-plugin:0.12.2_main\"\n          imagePullPolicy: \"Always\"\n          ports:\n          - containerPort: 5000\n</code></pre>"},{"location":"installation/helm/#interpreting-diff-results","title":"Interpreting Diff Results","text":"<p>The most important section to review in the diff output is the final portion showing actual deployment changes. In the example above, note the image tag change from <code>develop</code> to <code>0.12.2_main</code> for the <code>tree-viewer</code> deployment. This indicates that only the specified pod is being updated, which is the expected behavior for plugin deployments.</p> <p>All other changes shown in the diff (particularly TLS certificate rotations for Elasticsearch components) are routine infrastructure updates and do not require intervention.</p>"},{"location":"installation/plugin/","title":"Plugin","text":"<p>Work in progress...</p>"},{"location":"overview/integration/","title":"Clue From The Integrator's Perspective","text":""},{"location":"overview/integration/#clue-from-the-integrators-perspective","title":"Clue From The Integrator's Perspective","text":"<p>This tool is designed to be integrated into other Security Operations Center (SOC) tools, to enrich and inter-connect the different tools used and allow analysts to quickly assess and pivot from one tool to the other.</p> <p>Clue allows tool developers to enrich indicators (such as potentially malicious IPs, Hostnames, Ports, etc.) by dynamically querying those indicators in all the other relevant tools and showing the results directly in your UI.</p> <p>For example, say you were to use other CCCS open-source tools such as Howler (an Alert Triaging tool) and Assemblyline (a Malware Analysis tool). With Clue integration, while using Howler, if you were to look at an alert that contains a file hash indicator, the Clue enrichment would automatically search Assemblyline for the file hash, and tell you directly if it's known in Assemblyline, as well as additional info on the file hash.</p> <p>This section is for tool developers that want to integrate Clue enrichments, actions or fetchers into their own app.</p>"},{"location":"overview/integration/#integrating-clue-in-your-ui","title":"Integrating Clue In Your UI","text":"<p>In order to enrich indicators in your UI, you will need to import the clue-ui npm package in your project, initialize the ClueProvider with some configuration values such as the url of the Clue API server, and simply use one of the Enriched components, or one of the hooks available to enrich the data in question.</p>"},{"location":"overview/integration/#enrichments","title":"Enrichments","text":"<p>As mentioned before, Clue provides components and hooks that allow you to simply wrap your indicators, and enrich them by querying all the relevant plugins and displaying the information in the component.</p>"},{"location":"overview/integration/#actions","title":"Actions","text":"<p>Clue also allows for pre-defined actions to be executed on any indicator. Each plugin will provide Clue with a list of available actions, and the clue-ui library provides functions that let you list those actions, as well as execute them. Some actions might also require additional parameters to be specified, so there's also components provided to create a form to provide those additional informations.</p>"},{"location":"overview/integration/#fetchers","title":"Fetchers","text":"<p>Fetchers are another feature that allows plugin developers to render data in a more detailed way, such as generating a markdown file, JSON data or even an image. This could be useful to generate detailed reports on an indicator, render an email file and take a screenshot, or even show graphs.</p>"},{"location":"overview/plugin_developers/","title":"Clue From The Plugin Developer's Perspective","text":""},{"location":"overview/plugin_developers/#clue-from-the-plugin-developers-perspective","title":"Clue From The Plugin Developer's Perspective","text":"<p>In order for Clue to enrich data from a tool, it needs a plugin to be developed that will interface with the tool in question. The Clue central API server is a simple flask server that typically runs in a pod on a cluster, and the plugins are separate servers that usually run in pods in the same namespace, and communication between the two would rely on internal cluster networking, although the plugins could be hosted anywhere that is accessible by the central server.</p>"},{"location":"overview/plugin_developers/#getting-started","title":"Getting Started","text":"<p>Each plugin is registered on the central server by configuration, so all that's needed to connect a plugin to the central server is the plugin name, which types are supported by the plugin and where it can be found (url/port).</p> <p>The clue-api python library contains everything you need to get started on plugin development, and there's also a template plugin repository that can be used to quick start development.</p>"},{"location":"overview/users/","title":"Clue From The User's Perspective","text":""},{"location":"overview/users/#clue-from-the-users-perspective","title":"Clue From The User's Perspective","text":"<p>Users will generally encounter Clue through other apps integrating it into their UI, although it can also be used on it's own if necessary. Here are the different ways Clue can be used:</p>"},{"location":"overview/users/#enriched-data","title":"Enriched data","text":"<p>One of the ways Clue can be used in other apps is by enriching existing data, by replacing a simple component such as a Chip or Typography with an enriched version. This enriched data can show icons to represent either an Assessment (such as an IP assessed as \"false-positive\"), an Opinion (such as a Hostname being designated \"suspicious\") or additional Context (such as a country flag for a geolocated IP).</p> <p>This enriched data can also be interacted with by clicking, which will show a Details Popover. In this Popover, you can find what information each plugin provided in regards to the relevant data. In this menu, you have quick filters allowing you to refine which enrichments to display, external links to the different plugin providers, as well as icon buttons for different actions that can be done, such as refresh the query, copy to clipboard, execute additional enrichment or execute actions.</p>"},{"location":"overview/users/#executing-actions","title":"Executing Actions","text":"<p>Clue also allows users to execute certain plugin-specific actions. These actions will be shown under the \"Execute\" button in the Clue Popover, and can be selected to, for example, pivot to another app, or submit the data to a different application. Some actions will require additional information, and so might display a form prompting for the missing info.</p>"},{"location":"fr/","title":"Accueil","text":""}]}